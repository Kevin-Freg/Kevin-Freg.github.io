<!DOCTYPE html>
<html lang="de">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Multiple-Choice-Quiz</title>
    <link rel="stylesheet" href="./quizstyle.css" />
  </head>
  <body>
    <div class="container">
      <header>
        <div>
          <h1>
            Die Pr√ºfung des Frosches ‚Äî Nur der Auserw√§hlte kann alle Fragen
            beantworten
          </h1>
          <p class="lead">
            Trau dich die Fragen zu beantworten und ich sag dir ob du der
            richtige bist.
          </p>
        </div>
      </header>

      <main>
        <section id="quiz" class="card" aria-live="polite">
          <div class="progress" aria-hidden="true" style="margin-bottom: 12px">
            <i id="progressBar"></i>
          </div>

          <div id="questionArea"></div>

          <div
            style="
              display: flex;
              justify-content: space-between;
              align-items: center;
              margin-top: 14px;
            "
          >
            <div class="muted" id="qInfo">
              Frage <span id="current">1</span> von <span id="total">1</span>
            </div>
            <div class="controls">
              <button id="nextBtn" class="ghost small" disabled>N√§chste</button>
              <button id="restartBtn" class="ghost small">Zur√ºck</button>
            </div>
          </div>
        </section>

        <section id="endMessage" class="card" style="display: none">
          <h2>Ergebnis</h2>
          <p class="result" id="scoreText"></p>
          <p class="muted" id="feedbackText"></p>
          <div
            style="
              margin-top: 1rem;
              display: flex;
              gap: 0.5rem;
              flex-wrap: wrap;
            "
          >
            <button id="reviewBtn" class="ghost small">
              Antworten anzeigen
            </button>
            <button id="restartBtn2">Nochmal</button>
          </div>
        </section>

        <section id="review" class="card" style="display: none">
          <h3>Review ‚Äî richtige Antworten</h3>
          <div id="reviewList"></div>
        </section>
      </main>
    </div>

    <script>
      const QUESTIONS = [
        {
          type: "single",
          question: "Was ist der wichtigste gegenstand in Peak?",
          options: ["Bing Bong", "Seile", "Marshmallows", "Medikit"],
          correct: [0],
        },
        {
          type: "multiple",
          question:
            "Welche Aussagen √ºber JWT (JSON Web Token) sind korrekt? (Mehrere Antworten m√∂glich)",
          options: [
            "JWTs enthalten Claims, die signiert werden k√∂nnen",
            "JWTs sind von Natur aus verschl√ºsselt",
            "JWTs werden typischerweise im Authorization: Bearer <token> Header gesendet",
            "JWTs sind unbegrenzt g√ºltig, au√üer der Server l√∂scht sie",
          ],
          correct: [0, 2],
        },
        {
          type: "tf",
          question: "Freg hat ein Stein-Frosch als Haustier.",
          options: ["Wahr", "Falsch"],
          correct: [0],
        },
        {
          type: "single",
          question: "Wer ist unser Kapit√§n?",
          options: ["Gilbert", "Freg", "Kiki", "K√ºrawr"],
          correct: [2],
        },
        {
          type: "single",
          question: "Welchen Character mained Xellium in Overwatch 2?",
          options: ["Zarya", "Tracer", "Orisa", "Venture"],
          correct: [3],
        },
      ];

      let currentIndex = 0;
      let userAnswers = Array(QUESTIONS.length).fill(null);

      const totalEl = document.getElementById("total");
      const currentEl = document.getElementById("current");
      const questionArea = document.getElementById("questionArea");
      const progressBar = document.getElementById("progressBar");

      totalEl.textContent = QUESTIONS.length;

      function renderQuestion(index) {
        const q = QUESTIONS[index];
        currentEl.textContent = index + 1;

        let html = `<div class="question"><strong>${escapeHtml(
          q.question
        )}</strong></div>`;
        html += '<form id="qForm" aria-label="Antworten"><div class="answers">';

        q.options.forEach((opt, i) => {
          const inputType = q.type === "multiple" ? "checkbox" : "radio";
          const checkedAttr = isCheckedByUser(index, i) ? "checked" : "";
          html += `<label class="answer"><input type="${inputType}" name="answer" value="${i}" ${checkedAttr}> <span>${escapeHtml(
            opt
          )}</span></label>`;
        });

        html += "</div></form>";
        questionArea.innerHTML = html;

        // Button-Text anpassen
        const nextBtn = document.getElementById("nextBtn");
        nextBtn.textContent =
          index === QUESTIONS.length - 1 ? "Fertig" : "N√§chste";
        nextBtn.disabled = !hasSelection(index);

        // Listener f√ºr Auswahl
        questionArea.querySelectorAll("input").forEach((inp) =>
          inp.addEventListener("change", () => {
            saveSelectionFromForm(index);
            nextBtn.disabled = !hasSelection(index);
          })
        );

        updateProgressBar();
      }

      function isCheckedByUser(qIndex, optIndex) {
        const ans = userAnswers[qIndex];
        if (!ans) return false;
        if (Array.isArray(ans)) return ans.includes(optIndex);
        return ans === optIndex;
      }

      function saveSelectionFromForm(index) {
        const q = QUESTIONS[index];
        const inputs = questionArea.querySelectorAll("input");
        if (q.type === "multiple") {
          const chosen = [];
          inputs.forEach((i) => {
            if (i.checked) chosen.push(Number(i.value));
          });
          userAnswers[index] = chosen.length ? chosen : null;
        } else {
          const found = Array.from(inputs).find((i) => i.checked);
          userAnswers[index] = found ? Number(found.value) : null;
        }
      }

      function hasSelection(index) {
        const a = userAnswers[index];
        if (Array.isArray(a)) return a.length > 0;
        return a !== null && a !== undefined;
      }

      function nextQuestion() {
        if (currentIndex < QUESTIONS.length - 1) {
          currentIndex++;
          renderQuestion(currentIndex);
        } else {
          showResult();
        }
      }

      function updateProgressBar() {
        const pct = Math.round((currentIndex / QUESTIONS.length) * 100);
        progressBar.style.width = pct + "%";
      }

      function calculateScore() {
        let score = 0;
        QUESTIONS.forEach((q, idx) => {
          const user = userAnswers[idx];
          const correct = q.correct.slice().sort().toString();
          if (q.type === "multiple") {
            if (Array.isArray(user)) {
              const uSorted = user.slice().sort().toString();
              if (uSorted === correct) score += 1;
            }
          } else {
            if (user !== null && user !== undefined) {
              if ([].concat(q.correct).includes(user)) score += 1;
            }
          }
        });
        return score;
      }

      function showResult() {
        const score = calculateScore();
        const max = QUESTIONS.length;
        document.getElementById("quiz").style.display = "none";
        document.getElementById("endMessage").style.display = "block";
        document.getElementById(
          "scoreText"
        ).textContent = `Du hast ${score} von ${max} Punkten erreicht.`;

        // Feedback
        const pct = Math.round((score / max) * 100);
        let feedback = "";
        if (pct === 100)
          feedback =
            "Du bist der Auserw√§hlte ‚Äî Alles Gute zum Geburtstag!!! üéâ <br>Ich will dir noch sagen, dass egal bei welchem Spiel oder Call mit dir, die Atmosph√§re immer Cozy und Lustig ist. <br>Bleib weiterhin so, und vielleicht riecht man sich ja mal. ;)";
        else if (pct >= 80)
          feedback =
            "Ouh Fast Perfekt ‚Äî du bist aber nicht der den ich suche, bist du ein Spion? Oder hast du nur ein Fehler gemacht?";
        else if (pct >= 60)
          feedback =
            "Vielleicht war es Gl√ºck, dass du bis hierher gekommen bist, aber trauen tue ich dir nicht.";
        else feedback = "Hmmm, du scheinst hier falsch zu sein!!!";
        document.getElementById("feedbackText").innerHTML = feedback;
      }

      function showReview() {
        const review = document.getElementById("review");
        const container = document.getElementById("reviewList");
        container.innerHTML = "";

        QUESTIONS.forEach((q, idx) => {
          const user = userAnswers[idx];
          const correct = q.correct;
          let line = `<div style="margin-bottom:12px"><strong>${escapeHtml(
            q.question
          )}</strong><div class="muted">`;

          line +=
            "<div>Deine Antwort: " +
            (user === null
              ? "<em>keine Antwort</em>"
              : Array.isArray(user)
              ? user.map((i) => escapeHtml(q.options[i])).join(", ")
              : escapeHtml(q.options[user])) +
            "</div>";
          line += "</div></div>";
          container.innerHTML += line;
        });

        review.style.display = "block";
        window.scrollTo({
          top: document.body.scrollHeight,
          behavior: "smooth",
        });
      }

      function restart() {
        currentIndex = 0;
        userAnswers = Array(QUESTIONS.length).fill(null);
        document.getElementById("quiz").style.display = "block";
        document.getElementById("endMessage").style.display = "none";
        document.getElementById("review").style.display = "none";
        renderQuestion(0);
        updateProgressBar();
      }

      function escapeHtml(s) {
        return String(s)
          .replace(/&/g, "&amp;")
          .replace(/</g, "&lt;")
          .replace(/>/g, "&gt;");
      }

      function prevQuestion() {
        if (currentIndex > 0) {
          currentIndex--;
          renderQuestion(currentIndex);
        }
      }

      // Button-Events
      document.getElementById("nextBtn").addEventListener("click", () => {
        if (!hasSelection(currentIndex)) {
          alert("Bitte w√§hle zuerst eine Antwort.");
          return;
        }
        nextQuestion();
      });
      document
        .getElementById("restartBtn")
        .addEventListener("click", prevQuestion);
      document.getElementById("restartBtn2").addEventListener("click", restart);
      document
        .getElementById("reviewBtn")
        .addEventListener("click", showReview);

      // Initial render
      renderQuestion(0);
      updateProgressBar();
    </script>
  </body>
</html>

